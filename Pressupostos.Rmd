---
title: "Testes Estatísticos"
author: "Laura Alexandria"
date: "05/02/2021"
output: html_document
---

```{r message = F, warning=F}
library(tidyverse)
library(patchwork)
library(nortest)
library(here)
library(gt)

source(here("Graficos.R"))
```


# Modelos

```{r}
m1 <- lm(Total ~ Genero*Cargo, dados)
m2 <- lm(Total ~ Genero*Idade, dados)
m3 <- lm(Total ~ Genero*as.factor(Performance), dados)
m4 <- lm(Total ~ Genero*Titulo, dados)
m5 <- lm(Total ~ Genero*Departamento, dados)
m6 <- lm(Total ~ Genero*as.factor(Senioridade), dados)
```

```{r}
mod1 <- aov(Total ~ Genero*Cargo, dados)
mod2 <- aov(Total ~ Genero*Idade, dados)
mod3 <- aov(Total ~ Genero*as.factor(Performance), dados)
mod4 <- aov(Total ~ Genero*Titulo, dados)
mod5 <- aov(Total ~ Genero*Departamento, dados)
mod6 <- aov(Total ~ Genero*as.factor(Senioridade), dados)
summary(mod1)
summary(mod2)
summary(mod3)
summary(mod4)
summary(mod5)
summary(mod6)
```

```{r}
m1 <- lm(Total ~ Genero*Cargo, dados)
m2 <- lm(Total ~ Genero*Idade, dados)
m3 <- lm(Total ~ Genero*as.factor(Performance), dados)
m4 <- lm(Total ~ Genero*Titulo, dados)
m5 <- lm(Total ~ Genero*Departamento, dados)
m6 <- lm(Total ~ Genero*as.factor(Senioridade), dados)
summary(m1)
summary(m2)
summary(m3)
summary(m4)
summary(m5)
summary(m6)
```

```{r}
mod.teste <- aov(Total ~ Genero + Cargo + Idade + as.factor(Performance) + Titulo +
                Departamento + as.factor(Senioridade) + Genero*Cargo + 
             Genero*Idade + Genero*as.factor(Performance) + Genero*Titulo +
             Genero*Departamento + Genero*as.factor(Senioridade), dados)
```

# Análise de Resíduos

## Testes de Normalidade

```{r}
histograma <- function(var){
  ggplot(dados, aes(get(var))) + 
    geom_histogram(bins = 8, color = "White") +
      labs(y = "Frequência", x = "")
}

qqplot <- function(var){
  ggplot(dados, aes(sample =get(var))) + stat_qq() + stat_qq_line() +
    labs(x = "", y = "Valor Observado")
}

h1 <- histograma("Age")
h2 <- histograma("PagamentoBase")
h3 <- histograma("Bonus")
h4 <- histograma("Total")

qq1 <- qqplot("Age")
qq2 <- qqplot("PagamentoBase")
qq3 <- qqplot("Bonus")
qq4 <- qqplot("Total")

(h1+h2+h3+h4) / (qq1+qq2+qq3+qq4)
```

```{r}
testes <- data.frame(`Variavel` = c("Idade", "Pagamento Base", "Bonus", "Total"),
                     `P-valor` = round(c(ad.test(dados$Age)[[2]], 
                                   ad.test(dados$PagamentoBase)[[2]], 
                                   ad.test(dados$Bonus)[[2]],
                                   ad.test(dados$Total)[[2]]),4))
testes %>% gt()
```

Nitidamente a idade não aparenta seguir uma distribuição Normal. A variável de pagamento base apresenta formato de sino, bem como simetria, os pontos no qqpolt se apresentam todos próximos da reta, menos nas extremidades e a 5% de significância, o teste de Anderson-Darling também apontou que a distruibuição é normal. Em quanto que a variável com os bonus dos funcionários apesar do formato de sino, é possível observar um assimetria, no gráfico de qqplot os desvios nas extremidades também são maiores, e a 5% de significância o testes de Anderson-Darling indica que a variável não segue distribuição normal. E por fim, a variável Total, que representa a soma entre as duas variáveis anteriores, se comporta mais como a variável de pagamento base e também demonstra evidência amostral que siga a distribuição normal.

## Independência dos resíduos

```{r}
independencia <- function(mod){
  data <- cbind(dados, preditos = predict(mod), residuos = resid(mod)) 
  ggplot(data, aes(x = 1:1000, y= residuos)) + geom_point() +
  geom_hline(yintercept = 0, color = 'red')
}

i1 <- independencia(m1)
i2 <- independencia(m2)
i3 <- independencia(m3)
i4 <- independencia(m4)
i5 <- independencia(m5)
i6 <- independencia(m6)

(i1+i2+i3)/(i4+i5+i6)
```

```{r}
set.seed(2021)
car::durbinWatsonTest(m1)
car::durbinWatsonTest(m2)
car::durbinWatsonTest(m3)
car::durbinWatsonTest(m4)
car::durbinWatsonTest(m5)
car::durbinWatsonTest(m6)
```


## Homocedasticidade

```{r}
var_const <- function(mod){
  data <- cbind(dados, preditos = predict(mod), residuos = resid(mod)) 
  var <- ifelse(str_detect(mod, "1"), "Cargo", ifelse(str_detect(mod, "2"), "Idade",
         ifelse(str_detect(mod, "3"), "Performance", ifelse(str_detect(mod, "4"), "Titulo", ifelse(str_detect(mod, "5"),  "Departamento", "Senioridade")))))
  
  g1 <- ggplot(data, aes(x = preditos, y = residuos))+geom_point()
  g2 <- ggplot(data, aes(x = Genero, y = residuos))+geom_point()
  g3 <- ggplot(data, aes(x = get(var), y = residuos))+geom_point()
  
  g1+g2+g3
}

v1 <- var_const(m1)
v2 <- var_const(m2)
v3 <- var_const(m3)
v4 <- var_const(m4)
v5 <- var_const(m5)
v6 <- var_const(m6)

v1/v2/v3/v4/v5/v6
```


